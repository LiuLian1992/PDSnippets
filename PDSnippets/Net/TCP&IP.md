# TCP/IP


## 基本概念
网络由下往上分为:

　　物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。

IP协议对应于网络层
TCP/UDP协议对应于传输层,解决数据如何在网络中传输
HTTP协议对应于应用层,解决如何包装数据
Socket则是对TCP/IP协议的封装和应用(程序员层面上)

## IP
IP协议是用于将多个包交换网络连接起来的，它在源地址和目的地址之间传送一种称之为数据包的东西，它还提供对数据大小的重新组装功能，以适应不同网络对包大小的要求。

在网络中，一帧以太网数据包的格式：

>| Ethernet头 | IP头 | TCP/UDP | 数据 |

## TCP/UDP
传输层的核心协议是TCP和UDP：

TCP提供一对一的、面向连接的可靠通信服务。TCP建立连接，对发送的数据包进行排序和确认，并恢复在传输过程中丢失的数据包。
UDP提供一对一或一对多的、无连接的不可靠通信服务。

### TCP
TCP全称是Transmission Control Protocol，中文名为传输控制协议，它可以提供可靠的、面向连接的网络数据传递服务。传输控制协议主要包含下列任务和功能：
- 确保IP数据报的成功传递。
- 对程序发送的大块数据进行分段和重组。
- 确保正确排序及按顺序传递分段的数据。
- 通过计算校验和，进行传输数据的完整性检查。
- 根据数据是否接收成功发送肯定消息。通过使用选择性确认，也对没有收到的数据发送否定确认。
- 为必须使用可靠的、基于会话的数据传输程序，如客户端/服务器数据库和电子邮件程序，提供首选传输方法。

#### TCP 三次握手
TCP的连接建立过程又称为TCP三次握手;
- 首先发送方主机向接收方主机发起一个建立连接的同步（SYN）请求；
- 接收方主机在收到这个请求后向发送方主机回复一个同步/确认（SYN/ACK）应答；
- 发送方主机收到此包后再向接收方主机发送一个确认（ACK），此时TCP连接成功建立.

握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。
理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP 连接都将被一直保持下去。
断开连接时服务器和客户端均可以主动发起断开TCP连接的请求，断开过程需要经过“四次握手”

### UDP
UDP提供无连接的网络服务，该服务对消息中传输的数据提供不可靠的、最大努力传送。这意味着它不保证数据报的到达，也不保证所传送数据包的顺序是否正确。UDP由于排除了信息可靠传递机制，将安全和排序等功能移交给上层应用来完成，极大地降低了执行时间，使速度得到了保证。

### 端口号
TCP和UDP端口号被设计来区分运行在单个设备上的多重应用程序的IP地址。由于同一台计算机上可能会运行多个网络应用程序，所以计算机需要确保目标计算机上接收源主机数据包的软件应用程序的正确性，以及响应能够被发送到源主机的正确应用程序上。该过程正是通过使用TCP或UDP端口号来实现的。


## HTTP/HTTPS

### HTTP 协议
超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议。
http协议规定了客户端和服务器之间的数据传输格式。

HTTP 优点:

```
简单快速:
http协议简单,通信速度很快;
灵活:
http协议允许传输任意类型的数据;
短连接:
http协议限制每次连接只处理一个请求,服务器对客户端的请求作出响应后,马上断开连接.这种方式可以节省传输时间.
```

HTTP 连接最显著的特点是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接。从建立连接到关闭连接的过程称为“一次连接”。

#### HTTP 协议使用
1.请求:客户端向服务器索要数据
http协议规定:一个完整的http请求包含'请求行','请求头','请求体'三个部分;

- 请求行：包含了请求方法,请求资源路径,http协议版本. "GET /resources/images/ HTTP/1.1"
- 请求头:包含了对客户端的环境描述,客户端请求的主机地址等信息.
>Accept: text/html ( 客户端所能接收的数据类型 )
>Accept-Language: zh-cn ( 客户端的语言环境 )
>Accept-Encoding: gzip( 客户端支持的数据压缩格式 )
>Host: m.baidu.com( 客户端想访问的服务器主机地址 )
>User-Agent: Mozilla/5.0(Macintosh;Intel Mac OS X10.10 rv:37.0) >Gecko/20100101Firefox/37.0( 客户端的类型,客户端的软件环境 )

- 请求体:客户端发给服务器的具体数据,比如文件/图片等.

2.响应:服务器返回客户端想要的数据
http协议规定:一个完整的http响应包含'状态行','响应头','实体内容'三个部分;

- 状态行:包含了http协议版本,状态吗,状态英文名称.
"HTTP/1.1 200 OK"
- 响应头:包含了对服务器的描述,对返回数据的描述.
>Content-Encoding: gzip(服务器支持的数据压缩格式) Content-Length: 1528(返回数据的长度)
>Content-Type:application/xhtml+xml;charset=utf-8(返回数据的类型)
>Date: Mon,15Jun201509:06:46GMT(响应的时间) Server: apache (服务器类型)

- 实体内容:服务器返回给客户端的具体数据(图片/html/文件...).

3.发送http请求

#### HTTP 方法
GET、POST、OPTIONS、HEAD、PUT、DELETE、TRACE、CONNECT、PATCH

因为GET和POST可以实现上述所有操作,所以,在现实开发中,GET和POST方法使用的最为广泛，除此以外HEAD请求使用频率也比较高

- GET

```
在请求URL后面以?的形式跟上发给服务器的参数,参数以"参数名"="参数值"的形式拼接,多个参数之间用&分隔;
GET的本质是从服务器得到数据,效率更高.并且GET请求可以被缓存.
注意:GET的长度是有限制的,不同的浏览器有不同的长度限制,一般在2~8K之间;
```

- POST

```
POST的本质是向服务器发送数据,也可以获得服务器处理之后的结果,效率不如GET.POST请求不可以被缓存,每次刷新之后都需要重新提交表单.
发送给服务器的参数全部放在'请求体'中;
理论上,POST传递的数据量没有限制.
注意:所有涉及到用户隐私的数据(密码/银行卡号等...)都要用POST的方式传递.
```

- HEAD

```
HEAD方法通常用在下载文件之前,获取远程服务器的文件信息!相比于GET请求,不会下载文件数据,只获得响应头信息!
一般,使用HEAD方法的目的是提前告诉用户下载文件的信息,由用户确定是否下载文件!所以, HEAD方法,最好发送同步请求!
```

#### HTTP 状态码

1xx:信息响应类，表示接收到请求并且继续处理
2xx:处理成功响应类，表示动作被成功接收、理解和接受
3xx:重定向响应类，为了完成指定的动作，必须接受进一步处理
4xx:客户端错误，客户请求包含语法错误或者是不能正确执行
5xx:服务端错误，服务器不能正确执行一个正确的请求

### HTTPS
HTTPS = HTTP + SSL

HTTP 和 HTTPS 的不同之处
- HTTP 的 URL 以 http:// 开头，而 HTTPS 的 URL 以 https:// 开头
- HTTP 是不安全的，而 HTTPS 是安全的
- HTTP 标准端口是 80 ，而 HTTPS 的标准端口是 443
- 在 OSI 网络模型中，HTTP 工作于应用层，而 HTTPS 工作在传输层
- HTTP 无需加密，而 HTTPS 对传输的数据进行加密
- HTTP 无需证书，而 HTTPS 需要认证证书

#### 用 https 为什么更安全

http不安全，主要是因为它传输的是明文内容,也不对传输双方进行身份验证。只要在数据传输路径的任何一个环节上，都能看到传输的内容，甚至对其进行修改。

https比http安全指的是数据传输过程，而不是服务器后台的安全防护。https只能防止别人直接监听数据包拿到传输内容而已，对于服务器漏洞或者sql注入之类的，https并没有任何比http高明的地方。

这里要明确https的作用，https是用来加密网络上传输的数据，不对数据内容做验证。

举个例子： A给B写信，写完邮寄给B，但是在邮寄的过程中，邮递员可能会偷偷的把信取出来看完后再放回去，收发室大爷可能也会偷偷取出来看一眼，B收到信的时候，可能在传输过程中已经被很多人看过了。如果信件中有一些银行卡账号密码什么的，可能在传输过程中已经被别人悄悄记下来了。这就是HTTP。

A和B发现了这个问题，于是他们约定了下次写信要加密，A写信的时候加密，B收到信在解密，加密解密的方法只有A和B知道。同样在寄信的过程中，邮递员、收发室大爷偷偷看了信，但是完全看不懂，信件的内容不会泄露，就安全的多。这就是HTTPS。

## Socket

用 Socket 能够实现网络上的不同主机之间或同一主机的不同对象之间的数据通信。
现在 Socket 已经是一类通用通信接口的集合。
大的类型可以分为网络 Socket 和本地 Socket 两种。

利用Socket建立网络连接的步骤

建立Socket连接至少需要一对Socket，其中一个运行于客户端，称为ClientSocket，另一个运行于服务器端，称为ServerSocket。

Socket之间的连接过程分为三个步骤：服务器监听，客户端请求，连接确认。
- 1、服务器监听：服务器端Socket并不定位具体的客户端Socket，而是处于等待连接的状态，实时监控网络状态，等待客户端的连接请求。

- 2、客户端请求：指客户端的Socket提出连接请求，要连接的目标是服务器端的Socket。
为此，客户端的Socket必须首先描述它要连接的服务器的Socket，指出服务器端Socket的地址和端口号，然后就向服务器端Socket提出连接请求。
- 3、连接确认：当服务器端Socket监听到或者说接收到客户端Socket的连接请求时，就响应客户端Socket的请求，建立一个新的线程，把服务器端Socket的描述发给客户端，一旦客户端确认了此描述，双方就正式建立连接。

而服务器端Socket继续处于监听状态，继续接收其他客户端Socket的连接请求。
